<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <title>Upgrade / Pläne</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body class="p-3 bg-light">

<h2>Wähle deinen Plan</h2>
<p class="text-muted">
  Alle Pläne erfordern Bezahlmethode (z.B. Kreditkarte).
  Je nach Tier auch 7 Tage Testphase (z.B. Premium).
</p>

<div class="row row-cols-1 row-cols-md-2 g-4">
  <!-- ABO: Plus -->
  <div class="col">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Plus (z.B. 20 €/Monat)</h5>
        <p class="card-text">
          Eingeschränkte Daten, aber günstig.
          <br/>Auf Wunsch: 7 Tage Testphase bei Stripe (optional).
        </p>
        <button class="btn btn-info w-100" onclick="buyPlus()">
          Jetzt Plus buchen
        </button>
      </div>
    </div>
  </div>

  <!-- ABO: Premium -->
  <div class="col">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Premium (z.B. 50 €/Monat)</h5>
        <p class="card-text">
          Alle Taktzeitrechner, GPT usw.
          <br/>7 Tage Stripe-Trial
        </p>
        <button class="btn btn-primary w-100" onclick="buyPremium()">
          Jetzt Premium buchen
        </button>
      </div>
    </div>
  </div>

  <!-- One-off: Extended (1 Jahr) -->
  <div class="col">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Extended (z.B. 99 €/Jahr)</h5>
        <p class="card-text">
          Alles drin, abgerechnet als OneOff für 365 Tage.
        </p>
        <button class="btn btn-warning w-100" onclick="buyExtended()">
          Extended kaufen
        </button>
      </div>
    </div>
  </div>
</div>

<hr/>
<p>
  <a href="/mycalc/" class="btn btn-secondary">Zurück zu MyCalc</a>
</p>

<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
</script>
<script>
async function buyPlus(){
  try {
    const r = await fetch("/pay/create-checkout-session-subscription", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ which_tier:"plus" })
    });
    const d = await r.json();
    if(d.error){ alert(d.error); return; }
    window.location = d.checkout_url;
  } catch(err){ alert("Fehler: "+err); }
}

async function buyPremium(){
  try {
    const r = await fetch("/pay/create-checkout-session-subscription", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ which_tier:"premium" })
    });
    const d = await r.json();
    if(d.error){ alert(d.error); return; }
    window.location = d.checkout_url;
  } catch(err){ alert("Fehler: "+err); }
}

async function buyExtended(){
  try {
    const r = await fetch("/pay/create-checkout-session-oneoff", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ which_tier:"extended" })
    });
    const d = await r.json();
    if(d.error){ alert(d.error); return; }
    window.location = d.checkout_url;
  } catch(err){ alert("Fehler: "+err); }
}
</script>
</body>
</html>